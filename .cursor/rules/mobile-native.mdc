---
globs: apps/mobile/**
description: "Mobile-only native concerns: haptic feedback via HapticFeedback utility, Android DateTimePicker must be gated behind state."
---

# Mobile Native

## Haptic Feedback

**Always use the centralized `HapticFeedback` utility** — never call `Haptics` directly (it handles platform checks):

```typescript
import { HapticFeedback } from '@/lib/haptics';

HapticFeedback.light();     // button presses, selections, navigation
HapticFeedback.medium();    // important actions, form submissions
HapticFeedback.heavy();     // critical actions, deletions
HapticFeedback.selection(); // picker changes, tab switches
HapticFeedback.success();   // successful operations
HapticFeedback.error();     // error states
HapticFeedback.warning();   // warning states
```

Add haptic feedback to all interactive elements. Debounce for rapid interactions.

## DateTimePicker — Platform Differences

`@react-native-community/datetimepicker` behaves **very differently** on iOS vs Android. Always use platform-specific rendering.

### Android — CRITICAL: Gate behind state

On Android, the picker opens a **native modal dialog immediately on mount**. Never render it unconditionally.

```typescript
// WRONG — opens dialog immediately on Android
<DateTimePicker value={date} mode="date" onChange={handleDateChange} />

// CORRECT — gate behind state
const [showPicker, setShowPicker] = useState(false);

{showPicker && (
  <DateTimePicker
    value={date}
    mode="date"
    onChange={(event, selectedDate) => {
      setShowPicker(false);
      if (selectedDate) onDateChange(selectedDate);
    }}
  />
)}
```

**When refactoring Android DateTimePicker code:**
- Do NOT remove conditional rendering (`{show && <DateTimePicker />}`)
- Do NOT remove show/hide state variables
- Do NOT remove `setShow(false)` inside `onChange`

### iOS — Render inline with `display="compact"`

On iOS, `display="compact"` renders a **small tappable date label** that opens a calendar popover when tapped. The picker **is its own trigger** — no separate button needed.

```typescript
// iOS: render directly — no trigger button, no show/hide state
<DateTimePicker
  value={date}
  mode="date"
  display="compact"
  onChange={(event, selectedDate) => {
    if (selectedDate) onDateChange(selectedDate);
  }}
/>
```

- Do NOT wrap in a `TouchableOpacity` trigger button — the compact picker handles its own tap interaction
- Do NOT gate behind show/hide state — the picker should always be rendered
- Do NOT call `setShow(false)` in `onChange` — the popover dismisses itself

### Platform-aware pattern

```typescript
import { Platform } from 'react-native';
const isIOS = Platform.OS === 'ios';

{isIOS ? (
  <DateTimePicker value={date} mode="date" display="compact" onChange={handleChange} />
) : (
  <>
    <TouchableOpacity onPress={() => setShow(true)}>
      <Text>{formatDate(date)}</Text>
    </TouchableOpacity>
    {show && (
      <DateTimePicker value={date} mode="date" onChange={(e, d) => { setShow(false); if (d) handleChange(d); }} />
    )}
  </>
)}
