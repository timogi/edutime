---
alwaysApply: true
---

# Android DateTimePicker Modal Behavior

## CRITICAL: `@react-native-community/datetimepicker` opens a modal dialog on Android on mount

On **Android**, `DateTimePicker` renders as a **native modal dialog** that opens immediately when the component is mounted into the React tree. This means you must **never** render it unconditionally. It must be gated behind state that is `false`/`null` by default.

## Why This Rule Exists

An AI agent reverted the state-based conditional rendering of `DateTimePicker`, causing the date picker dialog to appear immediately and repeatedly on Android in the statistics screen. The AI did not understand that the `DateTimePicker` component opens a native dialog on mount on Android.

## üö´ Never Do This

```typescript
// ‚ùå NEVER render DateTimePicker unconditionally ‚Äî it opens a dialog on Android immediately
<DateTimePicker
  value={date}
  mode="date"
  onChange={handleDateChange}
/>
```

## ‚úÖ Always Do This

```typescript
// ‚úÖ Gate rendering behind state that defaults to false/null
const [showPicker, setShowPicker] = useState(false);

<TouchableOpacity onPress={() => setShowPicker(true)}>
  <Text>{formatDate(date)}</Text>
</TouchableOpacity>

{showPicker && (
  <DateTimePicker
    value={date}
    mode="date"
    onChange={(event, selectedDate) => {
      setShowPicker(false); // Always close after interaction
      if (selectedDate) onDateChange(selectedDate);
    }}
  />
)}
```

## Key Rules

1. **NEVER** render `DateTimePicker` without a state guard ‚Äî on Android it opens a modal on mount
2. **ALWAYS** default the state to `false`/`null` so the picker is hidden initially
3. **ALWAYS** set the state back to `false`/`null` in the `onChange` handler (before processing the date)
4. **ALWAYS** provide a visible touchable element for the user to tap to open the picker

## Files That Use DateTimePicker

- `components/ui/DateRangePicker.tsx` ‚Äî Statistics date range
- `app/(app)/index.tsx` ‚Äî Main timesheet screen date picker
- `components/DateInput.tsx` ‚Äî Record form date input
- `components/RecordForm/TimeInput.tsx` ‚Äî Record form time input

## ‚ö†Ô∏è Warning for AI Agents

When refactoring code that uses `DateTimePicker`:
- **Do NOT** remove conditional rendering (`{show && <DateTimePicker ... />}`)
- **Do NOT** remove the show/hide state variables
- **Do NOT** remove the `setShow(false)` call inside `onChange`
- These exist because Android's DateTimePicker opens a native dialog on mount
